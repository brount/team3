<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.team.medical.persitence.AdminDAO">

	<!-- 관리자 로그인 -->
	<select id="adminLoginPro" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) FROM admin WHERE adminid=#{id} AND
		adminpwd=#{pwd}
	</select>

	<!-- 일반회원목록 개수 -->
	<select id="getMemberListCnt" resultType="int">
		SELECT COUNT(*) FROM guest WHERE status = 0 AND sanctions = 0
	</select>

	<!-- 일반회원목록 조회 -->
	<select id="getMemberList" parameterType="java.util.Map" resultType="com.team.medical.vo.GuestVO">
		
			SELECT guestNo
				 , guestid
				 , guestname
				 , address2
				 , guestage
				 , guesttel
				 , sanctions
				 , guestdate
				 , rownum
			  from guest
	 <![CDATA[
			 where rownum >= #{start} 
			   AND rownum <= #{end}
			   AND status = 0
			   AND sanctions = 0
		]]>
	</select>

	<!-- 일반회원검색목록 개수 구하기 -->
	<select id="search_memberCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(guestNo) FROM guest
		<where>
			<choose>
				<when test="sc == 0 ">
					guestNo LIKE '%'||#{search}||'%'
				</when>
				<when test="sc == 1">
					AND guestname LIKE '%'||#{search}||'%'
				</when>
				<when test="sc == 2">
					AND guestid LIKE '%'||#{search}||'%'
				</when>
			</choose>
				AND sanctions = 0 
				AND status = 0
		</where>
	</select>
	
	<!-- 일반회원검색목록 조회 -->
	<select id="search_member" parameterType="java.util.Map" resultType="com.team.medical.vo.GuestVO">
		
			SELECT * FROM( SELECT guestNo
					 			, guestid
					 			, guestname
					 			, address2
					 			, guestage
					 			, guesttel
					 			, sanctions
					 			, guestdate
					 			, rownum
							 FROM (SELECT *
									 FROM guest
			<where>
				<choose>
					<when test="sc == 0 ">
						guestNo LIKE '%'||#{search}||'%'
					</when>
					<when test="sc == 1">
						AND guestname LIKE '%'||#{search}||'%'
					</when>
					<when test="sc == 2">
						AND guestid LIKE '%'||#{search}||'%'
					</when>
				</choose>
					AND sanctions = 0
					AND status = 0
			</where>
				ORDER BY guestid DESC
					)
				)
				<![CDATA[ 
	                  WHERE rownum >= #{start} AND rownum <= #{end}
      			]]>
	</select>

	<!-- 일반제제회원목록 개수 -->
	<select id="getMembersanctionsListCnt" resultType="int">
		SELECT COUNT(*) FROM guest WHERE sanctions != 0 AND status = 0
	</select>

	<!-- 일반제제회원목록 조회 -->
	<select id="getMembersanctionsList" parameterType="java.util.Map" resultType="com.team.medical.vo.GuestVO">
		<![CDATA[
			SELECT guestNo
				 , guestid
				 , guestname
				 , address2
				 , guestage
				 , guesttel
				 , sanctions
				 , guestdate
				 , rownum
			  from guest
			 where rownum >= #{start} 
			   AND rownum <= #{end}
			   AND sanctions != 0
			   AND status = 0
		]]>
	</select>

	<!-- 일반제제회원검색목록 개수 구하기 -->
	<select id="search_membersanctionsListCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(guestNo) FROM guest
		<where>
			<choose>
				<when test="sc == 0 ">
					guestNo LIKE '%'||#{search}||'%'
				</when>
				<when test="sc == 1">
					AND guestname LIKE '%'||#{search}||'%'
				</when>
				<when test="sc == 2">
					AND guestid LIKE '%'||#{search}||'%'
				</when>
			</choose>
				AND sanctions != 0
				AND status = 0
		</where>
	</select>
	
	<!-- 일반제제회원검색목록 불러오기 -->
	<select id="search_membersanctionsList" parameterType="java.util.Map" resultType="com.team.medical.vo.GuestVO">
		 
			SELECT * FROM( SELECT guestNo
					 			, guestid
					 			, guestname
					 			, address2
					 			, guestage
					 			, guesttel
					 			, sanctions
					 			, guestdate
					 			, rownum
							 FROM (SELECT *
									 FROM guest
			<where>
				<choose>
					<when test="sc == 0 ">
						guestNo LIKE '%'||#{search}||'%'
					</when>
					<when test="sc == 1">
						AND guestname LIKE '%'||#{search}||'%'
					</when>
					<when test="sc == 2">
						AND guestid LIKE '%'||#{search}||'%'
					</when>
				</choose>
					AND sanctions != 0
					AND status = 0
			</where>
				ORDER BY guestid DESC
					)
				)
				<![CDATA[ 
	                  WHERE rownum >= #{start} AND rownum <= #{end}
      			]]>
	</select>

	<!-- 일반탈퇴회원목록 개수 -->
	<select id="getMembersecessionListCnt" resultType="int">
		SELECT COUNT(*) FROM guest where status = 1
	</select>

	<!-- 일반탈퇴회원목록 조회 -->
	<select id="getMembersecessionList" parameterType="java.util.Map" resultType="com.team.medical.vo.GuestVO">
			SELECT guestNo
				 , guestid
				 , guestname
				 , address2
				 , guestage
				 , guesttel
				 , sanctions
				 , guestdate
				 , rownum
			  from guest
		<![CDATA[
			 where rownum >= #{start} 
			   AND rownum <= #{end}
			   AND status = 1
		]]>
	</select>

	<!-- 일반탈퇴회원검색목록 개수 구하기 -->
	<select id="search_membersecessionListCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(guestNo) FROM guest
		<where>
			<choose>
				<when test="sc == 0 ">
					guestNo LIKE '%'||#{search}||'%'
				</when>
				<when test="sc == 1">
					and guestname LIKE '%'||#{search}||'%'
				</when>
				<when test="sc == 2">
					and guestid LIKE '%'||#{search}||'%'
				</when>
			</choose>
				and status = 1
		</where>
	</select>
	
	<!-- 일반탈퇴회원검색목록 불러오기 -->
	<select id="search_membersecessionList" parameterType="java.util.Map" resultType="com.team.medical.vo.GuestVO">
			SELECT * FROM( SELECT guestNo
					 			, guestid
					 			, guestname
					 			, address2
					 			, guestage
					 			, guesttel
					 			, sanctions
					 			, guestdate
					 			, rownum
							 FROM (SELECT *
									 FROM guest
			<where>
				<choose>
					<when test="sc == 0 ">
						guestNo = #{search}
					</when>
					<when test="sc == 1">
						and guestname LIKE '%'||#{search}||'%'
					</when>
					<when test="sc == 2">
						and guestid LIKE '%'||#{search}||'%'
					</when>
				</choose>
				and status = 1
			</where>
				ORDER BY guestid DESC
					)
				)
				<![CDATA[ 
	                  WHERE rownum >= #{start} AND rownum <= #{end}
      			]]>
	</select>

	<!-- 일반탈퇴회원삭제 처리 -->
    <delete id="memberdeletePro">
   	 	DELETE guest WHERE guestNo=#{guestNo}
    </delete>

	<!-- 일반회원제제관리 조회 -->
	<select id="membersanctionManage" parameterType="java.util.Map" resultType="com.team.medical.vo.GuestVO">
		SELECT guestNo, guestname, guestid, sanctions FROM guest where guestNo=#{guestNo}
	</select>

	<!-- 일반회원제제관리 처리 -->
	<update id="membersanctionManagePro" parameterType="com.team.medical.vo.GuestVO"> 
		UPDATE  guest SET 
				guestNo		=	#{guestNo},
				guestname	=	#{guestname},
				guestid		=	#{guestid},
				sanctions	=	#{sanctions},
				reason		=	#{reason} 
		 WHERE  guestNo		=	#{guestNo} 
	</update>




	<!-- 약 목록 개수 -->
	<select id="getDrugListCnt" resultType="int">
		SELECT COUNT(*) FROM drug
	</select>

	<!-- 약 목록 조회 -->
	<select id="getDrugList" parameterType="java.util.Map" resultType="com.team.medical.vo.DrugVO">
		
			SELECT drugCode
				 , drugName
				 , drugCompany
				 , drugGroupCode
				 , drugGroup
				 , pro_usual
				 , admitDate
				 , registDate
				 , rownum
			  from drug
	 <![CDATA[
			 where rownum >= #{start} 
			   AND rownum <= #{end}
		]]>
	</select>
	




	<!-- 질병 목록 개수 -->
	<select id="getDiseaseListCnt" resultType="int">
		SELECT COUNT(*) FROM disease
	</select>

	<!-- 질병 목록 조회 -->
	<select id="getDiseaseList" parameterType="java.util.Map" resultType="com.team.medical.vo.DiseaseVO">
			SELECT diseaseCode
				 , diseaseName
				 , diseaseDefine
				 , diseaseSymptom
				 , diseaseDiagnosis
				 , diseaseCure
				 , complications
				 , prevention
				 , rownum
			  from disease
	 <![CDATA[
			 where rownum >= #{start} 
			   AND rownum <= #{end}
		]]>
		ORDER BY diseaseCode desc
	</select>

	<!-- 질병 목록 삭제 처리 -->
    <delete id="diseasedeletePro">
   	 	DELETE disease WHERE diseaseCode=#{diseaseCode}
    </delete>

	<!-- 질병검색목록 개수 구하기 -->
	<select id="search_diseaseListCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(diseaseCode) FROM disease
		<where>
			<choose>
				<when test="sc == 0 ">
					diseaseCode LIKE '%'||#{search}||'%'
				</when>
				<when test="sc == 1">
					and diseaseName LIKE '%'||#{search}||'%'
				</when>
				<when test="sc == 2">
					and diseaseSymptom LIKE '%'||#{search}||'%'
				</when>
				<when test="sc == 3">
					and complications LIKE '%'||#{search}||'%'
				</when>
			</choose>
		</where>
	</select>
	
	<!-- 질병검색목록 불러오기 -->
	<select id="search_diseaseList" parameterType="java.util.Map" resultType="com.team.medical.vo.DiseaseVO">
			SELECT * FROM( SELECT diseaseCode
				 				, diseaseName
				 				, diseaseDefine
				 				, diseaseSymptom
				 				, diseaseDiagnosis
				 				, diseaseCure
				 				, complications
				 				, prevention
				 				, rownum
							 FROM (SELECT *
									 FROM disease
			<where>
				<choose>
					<when test="sc == 0 ">
						diseaseCode LIKE '%'||#{search}||'%'
					</when>
					<when test="sc == 1">
						and diseaseName LIKE '%'||#{search}||'%'
					</when>
					<when test="sc == 2">
						and diseaseSymptom LIKE '%'||#{search}||'%'
					</when>
					<when test="sc == 3">
						and complications LIKE '%'||#{search}||'%'
					</when>
				</choose>
			</where>
				ORDER BY diseaseCode DESC
					)
				)
				<![CDATA[ 
	                  WHERE rownum >= #{start} AND rownum <= #{end}
      			]]>
	</select>

	<!-- 질병 추가 처리 -->
	<insert id="diseaseAdd" parameterType="com.team.medical.vo.DiseaseVO">
		insert into disease (diseaseCode, diseaseName, diseaseDefine, diseaseCause, diseaseSymptom, diseaseDiagnosis, diseaseCure, complications, prevention)
		values(disease_seq.nextval, #{diseaseName}, #{diseaseDefine}, #{diseaseCause}, #{diseaseSymptom}, #{diseaseDiagnosis}, #{diseaseCure}, #{complications}, #{prevention})
	</insert>
	
	<!-- 질병 수정 폼 -->
	<select id="diseaseModify" resultType="com.team.medical.vo.DiseaseVO">
		SELECT diseaseCode
			 , diseaseName
			 , diseaseDefine
			 , diseaseCause
			 , diseaseSymptom
			 , diseaseDiagnosis
			 , diseaseCure
			 , complications
			 , prevention
		  FROM disease 
		 WHERE diseaseCode = #{diseaseCode}
	</select>
	
	<!-- 질병 수정 처리 -->
	<update id="diseaseModifyPro" parameterType="com.team.medical.vo.DiseaseVO">
		UPDATE disease SET diseaseName		=	#{diseaseName}
						 , diseaseDefine	=	#{diseaseDefine}
						 , diseaseCause		=	#{diseaseCause}
						 , diseaseSymptom	=	#{diseaseSymptom}
						 , diseaseDiagnosis	=	#{diseaseDiagnosis}
						 , diseaseCure		=	#{diseaseCure}
						 , complications	=	#{complications}
						 , prevention		=	#{prevention}
		 WHERE diseaseCode = #{diseaseCode}
	</update>



	<!-- 운동목록 개수 -->
	<select id="getExerciseListCnt" resultType="int">
		SELECT COUNT(*) FROM exercise
	</select>

	<!-- 운동 목록 조회 -->
	<select id="getExerciseList" parameterType="java.util.Map" resultType="com.team.medical.vo.ExerciseVO">
			SELECT exerciseName
				 , exercisePurpose
				 , exerciseMerit
				 , exerciseDemerits
				 , exerciseCaution
				 , rownum
			  from exercise
	 <![CDATA[
			 where rownum >= #{start} 
			   AND rownum <= #{end}
		]]>
		ORDER BY exerciseName desc
	</select>

	<!-- 운동 목록 삭제 처리 -->
    <delete id="exercisedeletePro">
   	 	DELETE exercise WHERE exerciseName=#{exerciseName}
    </delete>

	<!-- 운동검색목록 개수 구하기 -->
	<select id="search_exerciseListCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(exerciseName) FROM exercise
		<where>
			<choose>
				<when test="sc == 0 ">
					exerciseName LIKE '%'||#{search}||'%'
				</when>
				<when test="sc == 1">
					and exercisePurpose LIKE '%'||#{search}||'%'
				</when>
				<when test="sc == 2">
					and exerciseMerit LIKE '%'||#{search}||'%'
				</when>
				<when test="sc == 3">
					and exerciseCaution LIKE '%'||#{search}||'%'
				</when>
			</choose>
		</where>
	</select>
	
	<!-- 운동검색목록 불러오기 -->
	<select id="search_exerciseList" parameterType="java.util.Map" resultType="com.team.medical.vo.ExerciseVO">
			SELECT * FROM( SELECT exerciseName
				 				, exercisePurpose
				 				, exerciseMerit
				 				, exerciseDemerits
				 				, exerciseCaution
				 				, rownum
							 FROM (SELECT *
									 FROM exercise
			<where>
				<choose>
					<when test="sc == 0 ">
						exerciseName LIKE '%'||#{search}||'%'
					</when>
					<when test="sc == 1">
						and exercisePurpose LIKE '%'||#{search}||'%'
					</when>
					<when test="sc == 2">
						and exerciseMerit LIKE '%'||#{search}||'%'
					</when>
					<when test="sc == 3">
						and exerciseCaution LIKE '%'||#{search}||'%'
					</when>
				</choose>
			</where>
				ORDER BY exerciseName DESC
					)
				)
				<![CDATA[ 
	                  WHERE rownum >= #{start} AND rownum <= #{end}
      			]]>
	</select>

	<!-- 운동 추가 처리 -->
	<insert id="exerciseAdd" parameterType="com.team.medical.vo.ExerciseVO">
		insert into exercise (exerciseName, exerciseMethod, exercisePurpose, exerciseMerit, exerciseDemerits, exerciseCaution)
		values(#{exerciseName}, #{exerciseMethod}, #{exercisePurpose}, #{exerciseMerit}, #{exerciseDemerits}, #{exerciseCaution})
	</insert>
	
	<!-- 운동 수정 폼 -->
	<select id="exerciseModify" resultType="com.team.medical.vo.ExerciseVO">
		SELECT exerciseName
			 , exerciseMethod
			 , exercisePurpose
			 , exerciseMerit
			 , exerciseDemerits
			 , exerciseCaution
		  FROM exercise 
		 WHERE exerciseName = #{exerciseName}
	</select>
	
	<!-- 운동 수정 처리 -->
	<update id="exerciseModifyPro" parameterType="com.team.medical.vo.ExerciseVO">
		UPDATE exercise SET exerciseName		=	#{exerciseName}
						  , exerciseMethod		=	#{exerciseMethod}
						  , exercisePurpose		=	#{exercisePurpose}
						  , exerciseMerit		=	#{exerciseMerit}
						  , exerciseDemerits	=	#{exerciseDemerits}
						  , exerciseCaution		=	#{exerciseCaution}
		 WHERE exerciseName = #{exerciseName}
	</update>
	


	<!-- 예방접종목록 개수 -->
	<select id="getApreventionListCnt" resultType="int">
		SELECT COUNT(*) FROM prevention
	</select>

	<!-- 예방접종목록 조회 -->
	<select id="getApreventionList" parameterType="java.util.Map" resultType="com.team.medical.vo.PreventionVO">
			SELECT preventionCode
				 , preventionKind
				 , countryCode
				 , preventionContent
				 , rownum
			  from prevention
	 <![CDATA[
			 where rownum >= #{start} 
			   AND rownum <= #{end}
		]]>
		ORDER BY preventionCode desc
	</select>
	
	<!-- 예방접종목록 조회2 -->
	<select id="getApreventionList2" parameterType="java.util.Map" resultType="com.team.medical.vo.DiseaseVO">
			SELECT diseaseName
				 , diseaseCode
				 , rownum
			  from disease d
			  join prevention p
			    on d.deseaseCode = p.deseaseCode
	 <![CDATA[
			 where rownum >= #{start} 
			   AND rownum <= #{end}
		]]>
		ORDER BY exerciseName desc
	</select>

	<!-- 이벤트 추가 -->
    <insert id="addEvent" parameterType="com.team.medical.vo.EventVO">
    INSERT
		INTO event (advertisementNo, doctorno, advertisementTitle, advertisementThumbnail ,advertisementImage, advertisementContents,
					advertisementRegDate, advertisementKind, advertisementStart, advertisementEnd, advertisementState)
		VALUES (advertisementnoseq.nextval, #{doctorno}, #{advertisementTitle}, #{advertisementThumbnail}, #{advertisementImage}, #{advertisementContents},
				sysdate, #{advertisementKind}, #{advertisementStart}, #{advertisementEnd}, #{advertisementState})
    </insert>
	<!-- 이벤트 수정 -->
	<update id="upEvent" parameterType="com.team.medical.vo.EventVO">
		UPDATE event SET advertisementTitle=#{advertisementTitle}, advertisementImage=#{advertisementImage},
			advertisementContents=#{advertisementContents},advertisementThumbnail=#{advertisementThumbnail}
			WHERE advertisementNo = #{advertisementNo}
	</update>
	<!-- 이벤트 삭제 -->
	<delete id="delEvent" parameterType="int">
		DELETE event WHERE advertisementNo = #{advertisementNo}
	</delete>
</mapper>